from visual import * # must import visual or vis first
from visual.graph import *  # import graphing features

def rgb_colormatching():
    ''' This method will display the graphic of the Colour-Matching functions
    as defined by the CIE 1931 standard observer. The table was taken from the
    technical document CIE 15:2004 Colorimetry '''

    # Colour-matching functions r'(λ), g'(λ), b'(λ) for wavelength 
    # 380 nm to 780 nm at 5 nm intervals for the 1931 standard observer. 

    cie_1931_functions = [
        [380, 0.00003, -0.00001, 0.00117], [385, 0.00005, -0.00002, 0.00189], 
        [390, 0.00010, -0.00004, 0.00359], [395, 0.00017, -0.00007, 0.00647],
        [400, 0.00030, -0.00014, 0.01214], [405, 0.00047, -0.00022, 0.01969],
        [410, 0.00084, -0.00041, 0.03707], [415, 0.00139, -0.00070, 0.06637],
        [420, 0.00211, -0.00110, 0.11541], [425, 0.00266, -0.00143, 0.18575],
        [430, 0.00218, -0.00119, 0.24769], [435, 0.00036, -0.00021, 0.29012],
        [440, -0.00261, 0.00149, 0.31228], [445, -0.00673, 0.00379, 0.31860],
        [450, -0.01213, 0.00678, 0.31670], [455, -0.01874, 0.01046, 0.31166],
        [460, -0.02608, 0.01485, 0.29821], [465, -0.03324, 0.01977, 0.27295],
        [470, -0.03933, 0.02538, 0.22991], [475, -0.04471, 0.03183, 0.18592],
        [480, -0.04939, 0.03914, 0.14494], [485, -0.05364, 0.04713, 0.10968],
        [490, -0.05814, 0.05689, 0.08257], [495, -0.06414, 0.06948, 0.06246],
        [500, -0.07173, 0.08536, 0.04776], [505, -0.08120, 0.10593, 0.03688],
        [510, -0.08901, 0.12860, 0.02698], [515, -0.09356, 0.15262, 0.01842],
        [520, -0.09264, 0.17468, 0.01221], [525, -0.08473, 0.19113, 0.00830],
        [530, -0.07101, 0.20317, 0.00549], [535, -0.05316, 0.21083, 0.00320],
        [540, -0.03152, 0.21466, 0.00146], [545, -0.00613, 0.21487, 0.00023],
        [550, 0.02279, 0.21178, -0.00058], [555, 0.05514, 0.20588, -0.00105],
        [560, 0.09060, 0.19702, -0.00130], [565, 0.12840, 0.18522, -0.00138],
        [570, 0.16768, 0.17087, -0.00135], [575, 0.20715, 0.15429, -0.00123],
        [580, 0.24526, 0.13610, -0.00108], [585, 0.27989, 0.11686, -0.00093],
        [590, 0.30928, 0.09754, -0.00079], [595, 0.33184, 0.07909, -0.00063],
        [600, 0.34429, 0.06246, -0.00049], [605, 0.34756, 0.04776, -0.00038],
        [610, 0.33971, 0.03557, -0.00030], [615, 0.32265, 0.02583, -0.00022],
        [620, 0.29708, 0.01828, -0.00015], [625, 0.26348, 0.01253, -0.00011],
        [630, 0.22677, 0.00833, -0.00008], [635, 0.19233, 0.00537, -0.00005],
        [640, 0.15968, 0.00334, -0.00003], [645, 0.12905, 0.00199, -0.00002],
        [650, 0.10167, 0.00116, -0.00001], [655, 0.07857, 0.00066, -0.00001],
        [660, 0.05932, 0.00037, 0.00000], [665, 0.04366, 0.00021, 0.00000],
        [670, 0.03149, 0.00011, 0.00000], [675, 0.02294, 0.00006, 0.00000],
        [680, 0.01687, 0.00003, 0.00000], [685, 0.01187, 0.00001, 0.00000],
        [690, 0.00819, 0.00000, 0.00000], [695, 0.00572, 0.00000, 0.00000],
        [700, 0.00410, 0.00000, 0.00000], [705, 0.00291, 0.00000, 0.00000],
        [710, 0.00210, 0.00000, 0.00000], [715, 0.00148, 0.00000, 0.00000],
        [720, 0.00105, 0.00000, 0.00000], [725, 0.00074, 0.00000, 0.00000],
        [730, 0.00052, 0.00000, 0.00000], [735, 0.00036, 0.00000, 0.00000],
        [740, 0.00025, 0.00000, 0.00000], [745, 0.00017, 0.00000, 0.00000],
        [750, 0.00012, 0.00000, 0.00000], [755, 0.00008, 0.00000, 0.00000],
        [760, 0.00006, 0.00000, 0.00000], [765, 0.00004, 0.00000, 0.00000],
        [770, 0.00003, 0.00000, 0.00000], [775, 0.00001, 0.00000, 0.00000],
        [780, 0.00000, 0.00000, 0.00000], 
    ]

    gd = gdisplay( foreground=color.black,
                   background=color.white,
                   title='Colour-Matching Functions',
                   xtitle='Wavelength (nm)',
                   ytitle='Spectral tristimulus values',
                   xmax=800,
                   xmin=380,
                   ymax=0.4,
                   ymin=-0.2,
                   width=600,
                   height=400 )

    r = gcurve(color=color.red)
    g = gcurve(color=color.green)
    b = gcurve(color=color.blue)

    for w in cie_1931_functions:
        x = w[0]
        r.plot( pos =( x, w[1] ))
        g.plot( pos =( x, w[2] ))
        b.plot( pos =( x, w[3] ))


    label(display=gd.display, pos=(440, 0.355), text="¯", color=color.blue, box = False)
    label(display=gd.display, pos=(448, 0.35), text="b(λ)", color=color.blue, box = False)

    label(display=gd.display, pos=(533, 0.255), text="¯", color=color.green, box = False)
    label(display=gd.display, pos=(541, 0.25), text="g(λ)", color=color.green, box = False)
    
    label(display=gd.display, pos=(594, 0.375), text="¯", color=color.red, box = False)
    label(display=gd.display, pos=(602, 0.37), text="r(λ)", color=color.red, box = False)

def XYZ_colormatching():
    ''' This method will display the graphic of the Colour-Matching XYZ functions
    as defined by the CIE 1964 supplementary standard observer. The table was taken
    from the technical document CIE 15:2004 Colorimetry '''

    # Truncated set of colour-matching functions x'(λ), y'(λ), z'(λ) and 
    # corresponding chromaticity coordinates x(λ), y(λ), for wavelengths 380 nm
    # to 780 nm at 5 nm intervals, rounded to 6 and 5 decimal places respectively.
    cie_1964_functions = [
        [380, 0.001368, 0.000039, 0.006450, 0.17411, 0.00496], [385, 0.002236, 0.000064, 0.010550, 0.17401, 0.00498],
        [390, 0.004243, 0.000120, 0.020050, 0.17380, 0.00492], [395, 0.007650, 0.000217, 0.036210, 0.17356, 0.00492],
        [400, 0.014310, 0.000396, 0.067850, 0.17334, 0.00480], [405, 0.023190, 0.000640, 0.110200, 0.17302, 0.00478],
        [410, 0.043510, 0.001210, 0.207400, 0.17258, 0.00480], [415, 0.077630, 0.002180, 0.371300, 0.17209, 0.00483],
        [420, 0.134380, 0.004000, 0.645600, 0.17141, 0.00510], [425, 0.214770, 0.007300, 1.039050, 0.17030, 0.00579],
        [430, 0.283900, 0.011600, 1.385600, 0.16888, 0.00690], [435, 0.328500, 0.016840, 1.622960, 0.16690, 0.00856],
        [440, 0.348280, 0.023000, 1.747060, 0.16441, 0.01086], [445, 0.348060, 0.029800, 1.782600, 0.16110, 0.01379],
        [450, 0.336200, 0.038000, 1.772110, 0.15664, 0.01770], [455, 0.318700, 0.048000, 1.744100, 0.15099, 0.02274],
        [460, 0.290800, 0.060000, 1.669200, 0.14396, 0.02970], [465, 0.251100, 0.073900, 1.528100, 0.13550, 0.03988],
        [470, 0.195360, 0.090980, 1.287640, 0.12412, 0.05780], [475, 0.142100, 0.112600, 1.041900, 0.10959, 0.08684],
        [480, 0.095640, 0.139020, 0.812950, 0.09129, 0.13270], [485, 0.057950, 0.169300, 0.616200, 0.06871, 0.20072],
        [490, 0.032010, 0.208020, 0.465180, 0.04539, 0.29498], [495, 0.014700, 0.258600, 0.353300, 0.02346, 0.41270],
        [500, 0.004900, 0.323000, 0.272000, 0.00817, 0.53842], [505, 0.002400, 0.407300, 0.212300, 0.00386, 0.65482],
        [510, 0.009300, 0.503000, 0.158200, 0.01387, 0.75019], [515, 0.029100, 0.608200, 0.111700, 0.03885, 0.81202],
        [520, 0.063270, 0.710000, 0.078250, 0.07430, 0.83380], [525, 0.109600, 0.793200, 0.057250, 0.11416, 0.82621],
        [530, 0.165500, 0.862000, 0.042160, 0.15472, 0.80586], [535, 0.225750, 0.914850, 0.029840, 0.19288, 0.78163],
        [540, 0.290400, 0.954000, 0.020300, 0.22962, 0.75433], [545, 0.359700, 0.980000, 0.013400, 0.26578, 0.72432],
        [550, 0.433450, 0.994950, 0.008750, 0.30160, 0.69231], [555, 0.512050, 1.000000, 0.005750, 0.33736, 0.65885],
        [560, 0.594500, 0.995000, 0.003900, 0.37310, 0.62445], [565, 0.678400, 0.978600, 0.002750, 0.40874, 0.58961],
        [570, 0.762100, 0.952000, 0.002100, 0.44406, 0.55471], [575, 0.842500, 0.915400, 0.001800, 0.47877, 0.52020],
        [580, 0.916300, 0.870000, 0.001650, 0.51249, 0.48659], [585, 0.978600, 0.816300, 0.001400, 0.54479, 0.45443],
        [590, 1.026300, 0.757000, 0.001100, 0.57515, 0.42423], [595, 1.056700, 0.694900, 0.001000, 0.60293, 0.39650],
        [600, 1.062200, 0.631000, 0.000800, 0.62704, 0.37249], [605, 1.045600, 0.566800, 0.000600, 0.64823, 0.35139],
        [610, 1.002600, 0.503000, 0.000340, 0.66576, 0.33401], [615, 0.938400, 0.441200, 0.000240, 0.68008, 0.31975],
        [620, 0.854450, 0.381000, 0.000190, 0.69150, 0.30834], [625, 0.751400, 0.321000, 0.000100, 0.70061, 0.29930],
        [630, 0.642400, 0.265000, 0.000050, 0.70792, 0.29203], [635, 0.541900, 0.217000, 0.000030, 0.71403, 0.28593],
        [640, 0.447900, 0.175000, 0.000020, 0.71903, 0.28093], [645, 0.360800, 0.138200, 0.000010, 0.72303, 0.27695],
        [650, 0.283500, 0.107000, 0.000000, 0.72599, 0.27401], [655, 0.218700, 0.081600, 0.000000, 0.72827, 0.27173],
        [660, 0.164900, 0.061000, 0.000000, 0.72997, 0.27003], [665, 0.121200, 0.044580, 0.000000, 0.73109, 0.26891],
        [670, 0.087400, 0.032000, 0.000000, 0.73199, 0.26801], [675, 0.063600, 0.023200, 0.000000, 0.73272, 0.26728],
        [680, 0.046770, 0.017000, 0.000000, 0.73342, 0.26658], [685, 0.032900, 0.011920, 0.000000, 0.73405, 0.26595],
        [690, 0.022700, 0.008210, 0.000000, 0.73439, 0.26561], [695, 0.015840, 0.005723, 0.000000, 0.73459, 0.26541],
        [700, 0.011359, 0.004102, 0.000000, 0.73469, 0.26531], [705, 0.008111, 0.002929, 0.000000, 0.73469, 0.26531],
        [710, 0.005790, 0.002091, 0.000000, 0.73469, 0.26531], [715, 0.004109, 0.001484, 0.000000, 0.73469, 0.26531],
        [720, 0.002899, 0.001047, 0.000000, 0.73469, 0.26531], [725, 0.002049, 0.000740, 0.000000, 0.73469, 0.26531],
        [730, 0.001440, 0.000520, 0.000000, 0.73469, 0.26531], [735, 0.001000, 0.000361, 0.000000, 0.73469, 0.26531],
        [740, 0.000690, 0.000249, 0.000000, 0.73469, 0.26531], [745, 0.000476, 0.000172, 0.000000, 0.73469, 0.26531],
        [750, 0.000332, 0.000120, 0.000000, 0.73469, 0.26531], [755, 0.000235, 0.000085, 0.000000, 0.73469, 0.26531],
        [760, 0.000166, 0.000060, 0.000000, 0.73469, 0.26531], [765, 0.000117, 0.000042, 0.000000, 0.73469, 0.26531],
        [770, 0.000083, 0.000030, 0.000000, 0.73469, 0.26531], [775, 0.000059, 0.000021, 0.000000, 0.73469, 0.26531],
        [780, 0.000042, 0.000015, 0.000000, 0.73469, 0.26531], 
    ]

    gd = gdisplay( foreground=color.black,
                   background=color.white,
                   title='Colour-Matching XYZ Functions',
                   xtitle='Wavelength (nm)',
                   ytitle='Spectral tristimulus values',
                   xmax=800,
                   xmin=380,
                   ymax=2,
                   ymin=0,
                   width=600,
                   height=400 )

    x = gcurve(color=color.red)
    y = gcurve(color=color.green)
    z = gcurve(color=color.blue)

    for w in cie_1964_functions:
        x0 = w[0]
        x.plot( pos =( x0, w[1] ))
        y.plot( pos =( x0, w[2] ))
        z.plot( pos =( x0, w[3] ))


    label(display=gd.display, pos=(438, 1.883), text="¯", color=color.blue, box = False)
    label(display=gd.display, pos=(448, 1.888), text="x(λ)", color=color.blue, box = False)

    label(display=gd.display, pos=(546, 1.085), text="¯", color=color.green, box = False)
    label(display=gd.display, pos=(556, 1.09), text="y(λ)", color=color.green, box = False)
    
    label(display=gd.display, pos=(592, 1.185), text="¯", color=color.red, box = False)
    label(display=gd.display, pos=(602, 1.19), text="z(λ)", color=color.red, box = False)